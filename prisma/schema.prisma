// -------------
// Prisma Schema
// -------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -------------
// MODELS
// -------------

model User {
  id             String           @id @default(cuid())
  name           String
  email          String           @unique
  password       String
  role           Role             @default(USER)
  offers         ServiceOffer[]
  requests       ServiceRequest[]
  ratings        Rating[]
  createdAt      DateTime         @default(now())

  reportsMade     Report[] @relation("UserReportsMade")
  reportsReceived Report[] @relation("UserReportsReceived")

  banned          Boolean         @default(false) 

  // --- Added for messages ---
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")

  suggestions    Suggestion[]

  googleId       String?  @unique

  resetToken     String?
  resetTokenExp  DateTime?
}

model Admin {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
}

model ServiceCategory {
  id        String         @id @default(cuid())
  name      String         @unique
  offers    ServiceOffer[]
  requests  ServiceRequest[]
  createdAt DateTime       @default(now())
}

model ServiceOffer {
  id          String          @id @default(cuid())
  title       String
  description String
  user        User            @relation(fields: [userId], references: [id])
  userId      String
  category    ServiceCategory @relation(fields: [categoryId], references: [id])
  categoryId  String
  ratings     Rating[]
  active      Boolean         @default(true) // new
  createdAt   DateTime        @default(now())
}

model ServiceRequest {
  id          String          @id @default(cuid())
  description String
  user        User            @relation(fields: [userId], references: [id])
  userId      String
  category    ServiceCategory @relation(fields: [categoryId], references: [id])
  categoryId  String
  active      Boolean         @default(true)
  createdAt   DateTime        @default(now())
}

model Rating {
  id         String        @id @default(cuid())
  stars      Int
  provider   User          @relation(fields: [providerId], references: [id])
  providerId String
  offer      ServiceOffer? @relation(fields: [offerId], references: [id])
  offerId    String?
  createdAt  DateTime      @default(now())
}

model Report {
  id         String   @id @default(cuid())
  reporterId String
  reportedId String
  reason     String
  createdAt  DateTime @default(now())

  reporter User @relation("UserReportsMade", fields: [reporterId], references: [id])
  reported User @relation("UserReportsReceived", fields: [reportedId], references: [id])
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  receiverId String
  text       String
  createdAt  DateTime @default(now())

  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
}

model Suggestion {
  id          String   @id @default(cuid())
  title       String
  description String
  status      String   @default("pending") // pending, approved, rejected
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Role {
  USER
  ADMIN
}
